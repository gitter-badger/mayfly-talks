<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="author" content="Maarten Dirkse"><title>Mayfly</title><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport"><link href="reveal.js/css/reveal.css" rel="stylesheet"><link rel="stylesheet" href="theme/bol.com-v2/bol.com.css" id="theme"><link href="highlight.js/styles/solarized_light.css" title="default syntax highlighting" rel="stylesheet"><link href="highlight.js/styles/solarized_dark.css" title="alternative syntax highlighting" rel="alternate stylesheet"><script type="text/javascript">document.write( '<link rel="stylesheet" href="reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );</script></head><body><div class="reveal"><div class="slides"><section><div id="header"><h1>Mayfly</h1><div class="details"><span class="author" id="author">Maarten Dirkse</span><br><span class="email" id="email"><a href="https://twitter.com/mdirkse">@mdirkse</a></span><br><span class="author" id="author2">Patrick van Dissel</span><br><span class="email" id="email2"><a href="https://twitter.com/pvdissel">@pvdissel</a></span></div></div></section><section id="_dockerize_your_user_stories"><h2>Dockerize your user stories</h2></section>
<section id="_problems"><h2>Problems</h2><div class="ulist"><ul><li><p>Central, shared test environment</p></li><li><p>Multiple teams in single codebase</p></li><li><p>Merge conflicts on <code>master</code></p></li><li><p>Unstable <code>master</code></p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>What&#8217;s the problem that Mayfly solves?</p><div class="ulist"><ul><li><p>Central test environment</p></li><li><p>Multiple teams in single codebase</p></li><li><p>Merge conflicts on <code>master</code></p></li><li><p>Unstable <code>master</code></p></li></ul></div></li></ul></div></aside></section>
<section><section id="_principles"><h2>Principles</h2><div class="ulist"><ul><li><p>Continuous Delivery</p></li><li><p><code>master</code> == production</p></li><li><p>Stories are short-lived</p></li></ul></div><aside class="notes"><div class="ulist"><ul><li><p>What principles does Mayfly follow, enforce, &#8230;&#8203;?</p><div class="ulist"><ul><li><p>continuous delivery</p><div class="ulist"><ul><li><p>no complete integration tests, unless production</p></li></ul></div></li><li><p>Master is production</p></li><li><p>stories are short-lived</p></li></ul></div></li></ul></div></aside></section><section id="_everything_as_code"><h2>Everything-as-code</h2><div class="ulist"><ul><li><p>Tests as code</p></li><li><p>Environments as code</p></li><li><p>Build pipelines as code</p></li><li><p>Definition of Done as code</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Tests as code, in the sense that
you want your tests to be automated.</p></div></aside></section></section>
<section id="_demo_time"><h2>Demo time</h2><div class="paragraph"><p>As a user,<br>
When I start working on a story,<br>
Then ..<br>
<a href="./images/20140724-mayfly-story-flow-demo.mp4">demo video</a></p></div></section>
<section><section id="_what_happened"><h2>What happened?</h2><div class="imageblock" style=""><div class="content"><img src="./images/mayfly-open-story-flow.png" alt="mayfly open story flow"></div></div><aside class="notes"><div class="olist arabic"><ol class="arabic"><li><p>Jira:</p><div class="ulist"><ul><li><p>Create story</p></li><li><p>Story &#8594; in-progress</p></li></ul></div></li><li><p>Grimm creates for story:</p><div class="ulist"><ul><li><p>feature branch</p></li><li><p>Jenkins pipeline</p></li><li><p>environment</p></li></ul></div></li></ol></div></aside></section><section id="_and_if_i_make_a_change"><h2>And if I make a change?</h2><div class="imageblock" style=""><div class="content"><img src="./images/mayfly-make-change-flow.png" alt="mayfly make change flow"></div></div>
<aside class="notes"><div class="olist arabic"><ol class="arabic"><li><p>Stash:</p><div class="ulist"><ul><li><p>Sends notification to Mayfly</p></li><li><p>Sends notification to Jenkins</p></li></ul></div></li><li><p>Mayfly:</p><div class="ulist"><ul><li><p>fetches latest Definition of Done</p></li></ul></div></li><li><p>Jenkins</p><div class="ulist"><ul><li><p>Triggers pipeline for story</p></li><li><p>Pushed Docker image to registry</p></li><li><p>Sends notification to Mayfly about pipeline state</p></li></ul></div></li><li><p>Mayfly, on pipeline state notification:</p><div class="ulist"><ul><li><p>Triggers deployment of new version on story environment</p></li><li><p>Verifies latest Definition of Done state</p></li></ul></div></li></ol></div></aside></section><section id="_and_if_i_resolve_my_story"><h2>And if I resolve my story?</h2><div class="imageblock" style=""><div class="content"><img src="./images/mayfly-resolve-story-flow.png" alt="mayfly resolve story flow"></div></div>
<aside class="notes"><div class="olist arabic"><ol class="arabic"><li><p>Jira:</p><div class="ulist"><ul><li><p>Resolve story as fixed</p></li><li><p>Sends notification to Mayfly</p></li></ul></div></li><li><p>Mayfly:</p><div class="ulist"><ul><li><p>Verifies if Definition of Done is completely OK</p></li><li><p>If so,</p><div class="ulist"><ul><li><p>Merge change to <code>master</code></p></li><li><p>Deploy Docker image to production</p></li><li><p>Story environment is removed</p></li><li><p>Feature branch is removed</p></li><li><p>Jenkins pipeline is removed</p></li></ul></div></li></ul></div></li></ol></div></aside></section><section id="_but_what_about_conflicts_on_code_master_code"><h2>But what about conflicts on <code>master</code>?</h2><div class="ulist"><ul><li class="fragment"><p>That never happens (no, really)</p></li></ul></div></section><section id="_automated_scm_workflow" data-transition="none"><h2>Automated SCM workflow</h2><div class="imageblock" style=""><div class="content"><img src="./images/scm-flow/scmflow1.png" alt="scmflow1"></div></div></section><section id="_automated_scm_workflow_2" data-transition="none"><h2>Automated SCM workflow</h2><div class="imageblock" style=""><div class="content"><img src="./images/scm-flow/scmflow2.png" alt="scmflow2"></div></div></section><section id="_automated_scm_workflow_3" data-transition="none"><h2>Automated SCM workflow</h2><div class="imageblock" style=""><div class="content"><img src="./images/scm-flow/scmflow3.png" alt="scmflow3"></div></div></section><section id="_automated_scm_workflow_4" data-transition="none"><h2>Automated SCM workflow</h2><div class="imageblock" style=""><div class="content"><img src="./images/scm-flow/scmflow4.png" alt="scmflow4"></div></div></section><section id="_automated_scm_workflow_5" data-transition="none"><h2>Automated SCM workflow</h2><div class="imageblock" style=""><div class="content"><img src="./images/scm-flow/scmflow5.png" alt="scmflow5"></div></div></section><section id="_automated_scm_workflow_6" data-transition="none"><h2>Automated SCM workflow</h2><div class="imageblock" style=""><div class="content"><img src="./images/scm-flow/scmflow6.png" alt="scmflow6"></div></div></section><section id="_automated_scm_workflow_7" data-transition="none"><h2>Automated SCM workflow</h2><div class="imageblock" style=""><div class="content"><img src="./images/scm-flow/scmflow7.png" alt="scmflow7"></div></div></section><section id="_automated_scm_workflow_8" data-transition="none"><h2>Automated SCM workflow</h2><div class="imageblock" style=""><div class="content"><img src="./images/scm-flow/scmflow8.png" alt="scmflow8"></div></div></section><section id="_automated_scm_workflow_9" data-transition="none"><h2>Automated SCM workflow</h2><div class="imageblock" style=""><div class="content"><img src="./images/scm-flow/scmflow9.png" alt="scmflow9"></div></div></section><section id="_automated_scm_workflow_10" data-transition="none"><h2>Automated SCM workflow</h2><div class="imageblock" style=""><div class="content"><img src="./images/scm-flow/scmflow10.png" alt="scmflow10"></div></div></section><section id="_but_i_need_an_integration_testing_environment"><h2>But I need an integration testing environment!</h2><div class="ulist"><ul><li class="fragment"><p>No, you don&#8217;t (really)</p></li></ul></div></section><section id="_old_style_development" data-transition="none"><h2>Old style development</h2><div class="imageblock" style=""><div class="content"><img src="./images/rip-acc/ripacc1.png" alt="ripacc1"></div></div></section><section id="_old_style_development_2" data-transition="none"><h2>Old style development</h2><div class="imageblock" style=""><div class="content"><img src="./images/rip-acc/ripacc2.png" alt="ripacc2"></div></div></section><section id="_old_style_development_3" data-transition="none"><h2>Old style development</h2><div class="imageblock" style=""><div class="content"><img src="./images/rip-acc/ripacc3.png" alt="ripacc3"></div></div></section><section id="_integration_testing" data-transition="none"><h2>Integration testing</h2><div class="imageblock" style=""><div class="content"><img src="./images/rip-acc/ripacc4.png" alt="ripacc4"></div></div></section><section id="_continuous_delivery" data-transition="none"><h2>Continuous delivery</h2><div class="imageblock" style=""><div class="content"><img src="./images/rip-acc/ripacc5.png" alt="ripacc5"></div></div></section><section id="_integration_test_time" data-transition="none"><h2>Integration test time!</h2><div class="imageblock" style=""><div class="content"><img src="./images/rip-acc/ripacc6.png" alt="ripacc6"></div></div></section><section id="__sigh" data-transition="none"><h2>"&#8230;&#8203;.. &lt;sigh&gt;"</h2><div class="imageblock" style=""><div class="content"><img src="./images/rip-acc/ripacc7.png" alt="ripacc7"></div></div></section><section id="_get_rid_of_the_version_lock" data-transition="none"><h2>Get rid of the version lock</h2><div class="imageblock" style=""><div class="content"><img src="./images/rip-acc/ripacc8.png" alt="ripacc8"></div></div></section><section id="_no_integration_environment"><h2>No integration environment?!</h2><div class="imageblock" style=""><div class="content"><img src="./images/testinproduction.jpg" alt="testinproduction"></div></div></section><section id="_no_integration_environment_2"><h2>No integration environment?!</h2><div class="ulist"><ul><li class="fragment"><p>Accept that, if you want CD, certain things can only be tested in production</p></li><li class="fragment"><p>Mayfly uses mocks and stubbing to achieve PRO-like fidelity in user story environments</p></li></ul></div></section></section>
<section><section id="_mayfly_architecture"><h2>Mayfly architecture</h2><div class="ulist"><ul><li><p>Grimm, coordinates the building of stories</p></li><li><p>Heimdall, decides if you may deploy your story to Production</p></li><li><p>Mario, lays the pipes for your story</p></li><li><p>Maxis, creates your story environment</p></li><li><p>Ratatouille, the rat called git</p></li><li><p>Devision, Jira plugin</p></li><li><p>Mayfly-Stash, Stash plugin</p></li></ul></div></section><section id="_stack"><h2>Stack</h2><div class="ulist"><ul><li><p>Jira</p></li><li><p>Stash</p></li><li><p>Jenkins with JobDSL</p></li><li><p>Mesos with Marathon</p></li><li><p>Docker</p></li><li><p>ActiveMQ</p></li><li><p>Backspin</p></li><li><p>Java</p></li></ul></div></section></section>
<section id="_current_state"><h2>Current state</h2><div class="ulist"><ul><li><p>Early development</p></li><li><p>Scope limited to simple services</p></li><li><p>Usage</p><div class="ulist"><ul><li><p>3 team services</p></li><li><p>(5) Mayfly services<br>
(eat our own dogfood)</p></li></ul></div></li></ul></div></section>
<section id="_future"><h2>Future</h2><div class="ulist"><ul><li><p>DB support; oracle, mongodb, &#8230;&#8203;</p></li><li><p>Add more team services</p></li><li><p>Working towards production ready</p></li><li><p>Open source</p></li></ul></div></section>
<section id="_we_re_hiring"><h2>We&#8217;re hiring!</h2><div class="paragraph"><p><a href="https://banen.bol.com" class="bare">banen.bol.com</a></p></div></section>
<section id="_thank_you"><h2>Thank you</h2><div class="paragraph"><p><a href="https://bolcom.github.io/mayfly-talks">Slides</a><br>
<a href="https://github.com/bolcom/mayfly-talks" class="bare">github.com/bolcom/mayfly-talks</a></p></div>
<div class="paragraph"><p>Maarten Dirkse <a href="https://twitter.com/mdirkse">@mdirkse</a><br>
Patrick van Dissel <a href="https://twitter.com/pvdissel">@pvdissel</a></p></div></section></div></div><script src="reveal.js/lib/js/head.min.js"></script><script src="reveal.js/js/reveal.js"></script><script type="text/javascript">// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display controls in the bottom right corner
  controls: true,
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: false,
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  previewLinks: false,
  // Theme (e.g., beige, black, blood, league, moon, night, serif, simple, sky, solarized, white)
  theme: Reveal.getQueryHash().theme || 'black',
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: Reveal.getQueryHash().transition || 'linear',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'default',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Optional libraries used to extend on reveal.js
  dependencies: [
    { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
    { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
    { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
    { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
    { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
    { src: 'reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
    { src: 'reveal.js/plugin/math/math.js', async: true}
  ]
});</script></body></html>